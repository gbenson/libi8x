%if 0%{?fedora}
  %global _i8x_python_dep python3
  %global _i8x_python_exe %{__python3}
%else
  %global _i8x_python_dep python
  %global _i8x_python_exe %{__python2}
%endif

Name:           @PACKAGE_NAME@
Version:        @PACKAGE_VERSION@
Release:        1%{?dist}
Summary:        A library for accessing Infinity functions
License:        LGPLv2+
URL:            https://infinitynotes.org/
Source:         https://infinitynotes.org/src/%{name}/%{name}-%{version}.tar.xz
BuildRequires:  py3c-devel
BuildRequires:  %{_i8x_python_dep}
BuildRequires:  %{_i8x_python_dep}-devel
BuildRequires:  %{_i8x_python_dep}-nose
BuildRequires:  %{_i8x_python_dep}-setuptools

%description
Infinity is a platform-independent system for executables and shared
libraries to expose functionality to debug, monitoring, and analysis
tooling.  In Infinity, executable and shared library files contain
platform-independent Infinity functions in addition to their regular
contents.  %{name} allows programs to execute these functions.

%package devel
Summary:        Development files for %{name}
Requires:       %{name} = %{version}-%{release}

%description devel
The %{name}-devel package contains libraries and header files for
developing applications that use %{name}.

%prep
%setup -q

%build
%configure PYTHON=%{_i8x_python_exe} --disable-static
%make_build

%check
make check VERBOSE=1

%install
make install DESTDIR=%{buildroot}

%post -p /sbin/ldconfig

%postun -p /sbin/ldconfig

%files
%defattr(-,root,root,-)
%license COPYING
%doc README NEWS
%{_libdir}/%{name}-%{version}.so
%{_libdir}/%{name}.so.*

%files devel
%defattr(-,root,root,-)
%{_includedir}/%{name}.h
%{_libdir}/%{name}.so
%{_libdir}/%{name}.la
%{_libdir}/pkgconfig/%{name}.pc
